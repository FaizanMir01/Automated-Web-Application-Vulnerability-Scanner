import subprocess
from pymongo import MongoClient

def run_sqlmap(url):
    try:
        # Run SQLMap as a subprocess
        process = subprocess.Popen(['sqlmap', '-u', url, '--batch'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        output, error = process.communicate()

        # Check the output for indications of SQL injection vulnerabilities
        if "sql injection" in output.decode().lower():
            print(f"SQL Injection vulnerability found at {url}")
            # You can parse and print more detailed information from SQLMap output if needed
        else:
            print(f"No SQL Injection vulnerability found at {url}")
    except Exception as e:
        print(f"Error scanning {url} for SQL injection: {e}")

def main():
    try:
        # Connect to MongoDB
        client = MongoClient('mongodb://localhost:27017/')
        db = client['urls_database']
        collection = db['urls']

        # Retrieve URLs from MongoDB
        urls = collection.distinct('url')

        # Run SQLMap for each URL
        for url in urls:
            run_sqlmap(url)
    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    main()
