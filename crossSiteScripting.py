import subprocess
from pymongo import MongoClient

def run_xss_scan(url):
    try:
        # Run XSStrike as a subprocess
        process = subprocess.Popen(['XSStrike', '-u', url], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        output, error = process.communicate()

        # Check the output for indications of XSS vulnerabilities
        if "vulnerable" in output.decode().lower():
            print(f"XSS vulnerability found at {url}")
        else:
            print(f"No XSS vulnerability found at {url}")
    except Exception as e:
        print(f"Error scanning {url} for XSS: {e}")

def main():
    # Connect to MongoDB
    client = MongoClient('mongodb://localhost:27017/')
    db = client['urls_database']
    collection = db['urls']

    # Iterate over documents in the collection and run XSStrike for each URL
    for document in collection.find():
        url = document['url']
        run_xss_scan(url)

    # Print a message after scanning all URLs
    print("Scanning completed.")

if __name__ == "__main__":
    main()
